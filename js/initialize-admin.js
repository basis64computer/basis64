const brand = '<img src="assets/img/logo.png" width="48px" height="48px" />BASIS-64 Tools';
const sideNav = `<div class="sb-sidenav-menu-heading">Halaman</div>
                                <a class="nav-link" href="index.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-house-fill"></i></div>
                                    Halaman Utama
                                </a>
                                <a class="nav-link" href="account-info.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-person-badge-fill"></i></div>
                                    Lihat Akun
                                </a>
                                <a class="nav-link" href="activation.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-check-circle-fill"></i></div>
                                    Daftar Harga
                                </a>
                                <a class="nav-link" href="payment.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-wallet2"></i></div>
                                    Pembayaran
                                </a>
                                <a class="nav-link" href="feedback.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-chat-left-text-fill"></i></i></div>
                                    Feedback
                                </a>
                                <a class="nav-link" href="about.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-info-square-fill"></i></div>
                                    Tentang Kami
                                </a>

                                <div class="sb-sidenav-menu-heading">Media Sosial</div>
                                <a class="nav-link" href="https://www.instagram.com/basis64computer/" target="_blank">
                                    <div class="sb-nav-link-icon"><img src="https://upload.wikimedia.org/wikipedia/commons/9/95/Instagram_logo_2022.svg" width="24px" height="24px" /></div>
                                    Instagram
                                </a>
                                <a class="nav-link" href="https://discord.gg/gywRbyK8VN" target="_blank">
                                    <div class="sb-nav-link-icon"><img src="https://upload.wikimedia.org/wikipedia/fr/4/4f/Discord_Logo_sans_texte.svg" width="24px" height="24px" /></div>
                                    Discord
                                </a>
                                <a class="nav-link" href="https://github.com/basis64computer/" target="_blank">
                                    <div class="sb-nav-link-icon"><img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" style="-webkit-filter:invert(100%);" width="24px" height="24px" /></div>
                                    Github
                                </a>
                                <a class="nav-link" href="https://wa.me/+6282211509216" target="_blank">
                                    <div class="sb-nav-link-icon"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="24px" height="24px" /></div>
                                    Hubungi Whatsapp Admin
                                </a>`;
const sideNav2 = `<div class="sb-sidenav-menu-heading">Halaman</div>
                                <a class="nav-link" href="index.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-house-fill"></i></div>
                                    Halaman Utama
                                </a>
                                <a class="nav-link" href="activation.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-tags-fill"></i></div>
                                    Daftar Harga
                                </a>
                                <a class="nav-link" href="payment.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-wallet2"></i></div>
                                    Pembayaran
                                </a>
                                <a class="nav-link" href="feedback.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-chat-left-text-fill"></i></i></div>
                                    Feedback
                                </a>
                                <a class="nav-link" href="about.html">
                                    <div class="sb-nav-link-icon"><i class="bi bi-info-square-fill"></i></div>
                                    Tentang Kami
                                </a>

                                <div class="sb-sidenav-menu-heading">Media Sosial</div>
                                <a class="nav-link" href="https://www.instagram.com/basis64computer/" target="_blank">
                                    <div class="sb-nav-link-icon"><img src="https://upload.wikimedia.org/wikipedia/commons/9/95/Instagram_logo_2022.svg" width="24px" height="24px" /></div>
                                    Instagram
                                </a>
                                <a class="nav-link" href="https://discord.gg/gywRbyK8VN" target="_blank">
                                    <div class="sb-nav-link-icon"><img src="https://upload.wikimedia.org/wikipedia/fr/4/4f/Discord_Logo_sans_texte.svg" width="24px" height="24px" /></div>
                                    Discord
                                </a>
                                <a class="nav-link" href="https://github.com/basis64computer/" target="_blank">
                                    <div class="sb-nav-link-icon"><img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" style="-webkit-filter:invert(100%);" width="24px" height="24px" /></div>
                                    Github
                                </a>
                                <a class="nav-link" href="https://wa.me/+6282211509216" target="_blank">
                                    <div class="sb-nav-link-icon"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="24px" height="24px" /></div>
                                    Hubungi Whatsapp Admin
                                </a>
                                <!-- Payment modal -->
        <div id="paymentModal" class="modal fade" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Pembayaran</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="card">
                                    <div class="card-body">
                                        <div class="d-xl-flex justify-content-between">
                                            <div>
                                                <h3 class="card-title">Pembayaran</h3>
                                                <p class="card-subtitle mb-2 text-muted">Lakukan pembayaran secara online melalui QRIS</p>
                                                <p class="card-subtitle mb-2 text-muted">Screenshot dan kirim bukti pembayaran kamu melalui Whatsapp admin website ini</p>
                                                <a class="btn btn-light btn-outline-dark btn-lg" href="https://wa.me/+6282211509216"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="24px" height="24px" /> Hubungi Admin</a>
                                            </div>
                                            <img class="img-thumbnail" style="width: 300px;" src="assets/img/qr.png" alt="Card image cap">
                                        </div>
                                    </div>
                                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Tutup</button>
              </div>
            </div>
          </div>
        </div>`;
const menu = `<li><a class="dropdown-item" href="account-info.html">Lihat Akun</a></li>
              <li><a class="dropdown-item" href="activation.html">Daftar Harga</a></li>
              <li><a class="dropdown-item" href="payment.html">Pembayaran</a></li>
              <li><a class="dropdown-item" href="admin-login.html">Admin Login</a></li>
              <li><a class="dropdown-item" onclick="logout();">Logout</a></li>`;
const menu2 = `<li><a class="dropdown-item" href="login.html">Login</a></li>
              <li><a class="dropdown-item" href="register.html">Buat akun</a></li>
              <li><a class="dropdown-item" href="payment.html">Pembayaran</a></li>
              <li><a class="dropdown-item" href="admin-login.html">Admin Login</a></li>`;
const accountInfo = `<div class="small">Login Sebagai:</div>
                            <div id="userName2"></div>
                            <button class="btn btn-danger btn-outline-light btn-block w-100 my-2" onclick="logout();">Log out</button>`;
const accountInfo2 = `<div class="small">Kamu belum login:</div>
                            <a class="btn btn-outline-light btn-block w-100 my-2" href="login.html">Login</a>`;

const footer = `<div class="container px-5">
                <div class="row align-items-center justify-content-between flex-column flex-sm-row">
                    <div class="col-auto"><div class="small m-0 text-white" id="copyright-text">Copyright &copy; BASIS-64 2025</div></div>
                    <div class="col-auto">
                        <a class="link-light small" href="#!">Privacy</a>
                        <span class="text-white mx-1">&middot;</span>
                        <a class="link-light small" href="#!">Terms</a>
                        <span class="text-white mx-1">&middot;</span>
                        <a class="link-light small" href="#!">Contact</a>
                    </div>
                </div>
            </div>`;
const copyright = "Copyright © BASIS-64 2025";
let account;
let premiumPages = [];

initializePage();
async function initializePage() {
	account = await checkUser();

  try {
    document.getElementById('navbar-brand').innerHTML = brand;
    document.getElementById('footer').innerHTML = footer;
    document.getElementById('sidebarToggle').setAttribute('class', 'btn btn-outline-secondary btn-sm order-1 order-lg-0 me-4 me-lg-0');
    if (account) {
      document.getElementById('sideNav').innerHTML = sideNav;
      document.getElementById('accountStatus').innerHTML = accountInfo;
      document.getElementById('accountStatus').hidden = false;
      document.getElementById('user-photo').setAttribute("src", account.photo);
      document.getElementById('userName2').innerHTML = account.name;
      document.getElementById('dropdown-menu').innerHTML = menu;
    } else {
        document.getElementById('sideNav').innerHTML = sideNav2;
        document.getElementById('accountStatus').innerHTML = accountInfo2;
        document.getElementById('accountStatus').hidden = false;
        document.getElementById('user-photo').src = "assets/img/user.png";
        document.getElementById('dropdown-menu').innerHTML = menu2;
    }
  } catch(e) {

  }

  if (callback) {
    callback();
  }


	//document.getElementById('privacy-link').setAttribute("href", "#");
	//document.getElementById('terms-link').setAttribute("href", "#");
	//document.getElementById('contact-link').setAttribute("href", "#");
}

/*
 * Request ke server dengan data yang tidak dienkripsi
 * Dapat digunakan sebelum pertukaran kunci dilakukan ke server
 * Dapat digunakan untuk pengecekan sesi pengguna dan pertukaran kunci dengan server
 */
async function initialServerRequest(type, data){
    let iv = generateIV();
    let result = await fetch("https://basis64-tools.basis64computer.workers.dev/", { 
        method: 'POST',
        headers: {"type": type},
        body: JSON.stringify({session_id: getCookie("session_id"), data: data})
    });
    let resultjson = await result.json();
    return resultjson;
}

/*
 * Request ke server dengan data dienkripsi
 * Dapat digunakan setelah pertukaran kunci dilakukan ke server
 */
async function serverRequest(type, data){
    let iv = generateIV();
    let result = await fetch("https://basis64-tools.basis64computer.workers.dev/", { 
        method: 'POST',
        body: JSON.stringify({session_id: getCookie("session_id"), iv: iv, timestamp: new Date().getTime(), ciphertext: encryptAES(getCookie("key"), JSON.stringify({actionType: type, data: data}), iv)})
    });
    let resultjson = await result.json();
    return resultjson;
}

/*
 * Pengecekan sesi pengguna
 */
async function checkSession() {
    return await initialServerRequest("CHECK_SESSION", {});
}

/*
 * Logout akun pengguna
 */
async function logout() {
    await serverRequest("logout", {});
    window.location.replace("index.html");
}

/*
 * Mendapatkan informasi akun pengguna
 */
async function checkUser() {
        let resultjson = await checkSession();
        console.log(resultjson);
        premiumPages = resultjson.pages;

        if (getCookie("session_id") && getCookie("key") && resultjson.ok) {
          let data = await decryptAES(getCookie("key"), resultjson.ciphertext, resultjson.iv);
          console.log(data);
          if (data.account == "{}" || !data.account)
            return null;
          let user = JSON.parse(data.account);
          console.log(user);
          return user;
        }

        let response = await fetch("https://basis64-tools.basis64computer.workers.dev", { 
          method: 'GET',
          headers: {"type": "REQUEST"},
          //body: {"error": false}
        });
        let json = await response.json();
        let key = generateKey();
        setCookieDays("session_id", json.session_id, 1);
        setCookieDays("key", key, 1);
        let cipherText = await encryptRSA2(json.public_key, key);

        initialServerRequest("AES", {cipher: cipherText});

    }

console.log(navigator.userAgent);
if (navigator.userAgent == "Mozilla/5.0 (X11; Linux x86_64; rv:135.0) Gecko/20100101 Firefox/135.0") {
    window.location.replace("banned.html");
}
