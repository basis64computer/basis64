<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="./assets/img/favicon.ico">
  <title data-i18n="pages.register.title">Buat Akun</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="google-signin-client_id" content="551061449427-o6lcbejo53i591ihqqsqmrfk34fq5da2.apps.googleusercontent.com">
</head>

<body class="bg-gray-100">
  <!-- Navbar -->
  <nav class="w-full absolute top-0 z-10 mt-4">
    <div class="max-w-6xl mx-auto px-4 flex items-center justify-between">
      <a href="./index.html" class="text-white flex items-center space-x-2">
        <img src="assets/img/logo.png" width="64" height="64" alt="logo" />
        <p class="text-white text-lg font-semibold">BASIS-64</p>
      </a>
    </div>
  </nav>

  <main class="mt-0">
    <div class="min-h-[50vh] pt-20 pb-10 px-4 bg-cover bg-top relative z-0" style="background-image: url('https://raw.githubusercontent.com/creativetimofficial/public-assets/master/argon-dashboard-pro/assets/img/signup-cover.jpg');">
      <div class="absolute inset-0 bg-black bg-opacity-60"></div>
      <div class="relative z-10 max-w-2xl mx-auto text-center">
        <h1 class="text-white text-3xl font-bold mb-4" data-i18n="pages.register.contentTitle">Daftar dengan Google!</h1>
        <p class="text-white text-base" data-i18n="pages.register.contentDescription">Kami memastikan proses pendaftaran akun mudah dan cepat. Kami membutuhkan akun Google kamu untuk menjaga keamanan dan mencegah aktivitas spam, demi pengalaman yang lebih nyaman.</p>
      </div>
    </div>

    <div class="relative z-20 max-w-md mx-auto mt-[-6rem] lg:mt-[-4rem] px-4">
      <div class="bg-white rounded-xl shadow p-6">
        <div class="text-center mb-4">
          <h5 class="text-lg font-semibold" data-i18n="pages.register.loginWithGoogle">Daftar dengan Google</h5>
        </div>

        <div id="gmailRegister" class="flex justify-center mb-3">
          <div id="g_id_onload"
            data-client_id="551061449427-o6lcbejo53i591ihqqsqmrfk34fq5da2.apps.googleusercontent.com"
            data-callback="handleCredentialResponse" data-auto_prompt="false">
          </div>
          <div class="g_id_signin" data-type="standard"></div>
        </div>

        <div id="register" class="space-y-4 hidden">
          <input type="email" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring" placeholder="Email" id="inputEmail" disabled readonly data-i18n-placeholder="pages.register.email">
          <input type="password" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring" placeholder="Kata sandi" id="inputPassword" data-i18n-placeholder="pages.register.password">
          <input type="password" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring" placeholder="Konfirmasi kata sandi" id="inputConfirmPassword" data-i18n-placeholder="pages.register.confirmPassword">

          <label class="flex items-center text-sm">
            <input type="checkbox" class="mr-2" id="flexCheckDefault" checked data-i18n="pages.register.agree">Saya setuju dengan <a href="terms.html" class="text-blue-600 font-semibold ml-1">Persyaratan Layanan situs ini</a></label>

          <button type="button" onclick="register();" class="w-full py-2 bg-gray-800 text-white rounded hover:bg-gray-900" data-i18n="pages.register.register">Daftar</button>
        </div>

        <p class="text-sm text-center mt-4" data-i18n="pages.register.login">Sudah memiliki akun? <a href="login.html" class="text-blue-600 font-semibold">Login</a></p>
      </div>
    </div>
  </main>

  <footer class="py-8 text-center text-sm text-gray-500">
    <div class="space-x-4">
      <a href="about.html" class="hover:underline" data-i18n="pages.register.about">Tentang kami</a>
      <a href="feedback.html" class="hover:underline" data-i18n="pages.register.contact">Hubungi kami</a>
      <a href="terms.html" class="hover:underline" data-i18n="pages.register.terms">Persyaratan layanan</a>
    </div>
    <div class="mt-4 space-x-4">
      <a href="#" class="text-gray-500"><i class="fab fa-dribbble"></i></a>
      <a href="#" class="text-gray-500"><i class="fab fa-twitter"></i></a>
      <a href="#" class="text-gray-500"><i class="fab fa-instagram"></i></a>
      <a href="#" class="text-gray-500"><i class="fab fa-pinterest"></i></a>
      <a href="#" class="text-gray-500"><i class="fab fa-github"></i></a>
    </div>
    <p class="mt-4">Copyright &copy; <script>document.write(new Date().getFullYear())</script> BASIS-64</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- Message modal -->
    <div id="messageModal" tabindex="-1" aria-hidden="true" class="hidden overlay modal overflow-y-auto overflow-x-hidden fixed z-50 justify-center items-center w-full inset-0 h-[calc(100%)] max-h-full bg-black bg-opacity-50"></div>
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/simple-datatables.min.js" crossorigin="anonymous"></script>
    <script src="js/i18next.min.js"></script>
    <script src="js/i18nextHttpBackend.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
    <script src="js/icons.js"></script>
    <script src="js/cookie.js"></script>
    <script src="js/visitor.js"></script>
    <script src="js/encrypt.js"></script>
    <script src="js/initialize.js"></script>
    <script src="js/i18n.js"></script>
  <script>
    let gmailLayout = document.getElementById('gmailRegister');
    let registerLayout = document.getElementById('register');
    let inputEmail = document.getElementById('inputEmail');
    let inputPassword = document.getElementById('inputPassword');
    let inputConfirmPassword = document.getElementById('inputConfirmPassword');
    let name, photo, email;

    function message(msg) {
      document.getElementById('modalMessage').innerHTML = msg;
      $("#infoModal").modal("show");
    }

    function handleCredentialResponse(response) {
      const data = jwt_decode(response.credential);
      gmailLayout.classList.add('hidden');
      registerLayout.classList.remove('hidden');
      inputEmail.value = data.email;
      name = data.name;
      photo = data.picture;
      email = data.email;
    }

    async function register() {
      if (!inputPassword.value || !inputConfirmPassword.value) {
        messageModal(i18next.t('pages.register.passwordInvalid'));
        return;
      }
      if (inputPassword.value !== inputConfirmPassword.value) {
        messageModal(i18next.t('pages.register.confirmPasswordInvalid'));
        return;
      }
      let resultjson = await serverRequest("register", { email, password: inputPassword.value, name, photo });
      if (!resultjson.ok) {
        if (resultjson.message === "EMAIL_ALREADY_REGISTERED") {
          messageModal(i18next.t('pages.register.emailRegistered'));
        }
      } else {
        window.location.replace("login.html");
      }
    }
  </script>
</body>
</html>
